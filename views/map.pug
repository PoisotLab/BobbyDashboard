extends master

block infopane
    div
        INFO

block contentpane
    div#map

block scripts
    script.
        $(".nav_map").addClass("active")
        // Get the map background
        var mymap = L.map('map').setView([-37, 175], 7);
        var layer = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'ESRI',
            maxZoom: 19
            });
        layer.addTo(mymap);
        // Add the pins for each observation
        function getObsPaged(page) {
            $.ajax({
                type: 'GET',
                url: '/obs/' + page,
                success: function(data) {
                    for (var i = 0; i < data.length; i++) {
                        var obs = data[i];
                        L.marker([Number(obs.latitude), Number(obs.longitude)]).addTo(mymap)
                    }
                    getObsPaged(page+1)
                }
            })
        }
        getObsPaged(1)

